# deque简介

![deque对外呈现](../../../images/stl/deque对外呈现.png)

deque是一个可存放T类型的，存储空间可变的蓄力容器。

* deque同样是一种连续性存储容器；

* deque是一种**首尾均能高效**插入和删除元素的双向开口容器；

* deque对象可在栈中，也可在堆中；

* deque的元素存储在堆中；

* deque的元素个数可变，且元素可重复。

![deque存储结构](../../../images/stl/deque存储结构.png)

**存储结构说明：**

deque虽然对外呈现是一个连续性存储空间，但deque内部真实存储结构是由一小块连续空间组成的map(注：不是STL中的map容器)，和多个定量连续存储区(存储元素的空间)构成。

* map存储的是指向各个定量连续存储区的指针；
* 元素存储区中，存储的是用户保存进来的元素；
* map已经被占满，需要在首尾插入新元素时：
  * 重新map的存储空间；
  * 将原map中的存储区指针拷贝到新的map存储空间；
  * 分配相应的元素存储区，并将其首地址保存到map中；
  * 将新元素添加到新分配的元素存储区

deque存储空间不足时，只需要新增分配的存储空间，无需将原有的元素拷贝到新存储空间。

**vector 与 deque对比**

|          |     vector      |      deque      |
| -------- | :-------------: | :-------------: |
| 首端插入 | **insert:$O(n)$**| push_front:$O(1)$|
| 首端删除 | **erase:$O(n)$**| pop_front:$O(1)$ |
| 尾端插入 | push_back:$O(1)$| push_back:$O(1)$|
| 尾端删除 |  pop_back:$O(1)$|  pop_back:$O(1)$|
| capacity |       有        |       无        |
| reserve  |       有        |       无        |
| 随机访问 |   效率相对高    |   效率相对低    |
| 排序     |   效率相对高    |   效率相对低    |

a. vector在首端插入或者删除，后续的元素都会被向后或者向前移动，其时间复杂度为$O(n)$；deque中无需移动已有元素。
b. 在尾端插入或者删除元素，vector和deque效率均相同，不涉及元素的移动。
c. deque是动态的以分段连续空间组成，随时可增加一段元素存储区到deque的map管理中。因此，不涉及capacity和reserve。
d. 由于deque存储结构的特殊性，不能像vector那样很快速的实现随机访问，需要进行相关的计算。因此，随机访问相对vector来说，效率相对较低。排序需要使用到随机访问，在使用相同的排序算法情况下，deque效率相对较低。
 
**类声明：**

```c++
template<
    class T,
    class Allocator = std::allocator<T>
> class deque;

// 头文件包含
#include <deque>
```

**容器相关操作：**

* 增：deque容器中增加新元素，**可能**涉及内存数据搬移

  * 容器首尾新增元素，不涉及元素搬移，时间复杂度为$O(1)$
  * 容器中间插入新元素，涉及元素搬移，时间复杂度为$O(n)$

* 删：deque容器中删除某元素，可能涉及内存数据搬移

  * 容器首尾删除元素，不涉及元素搬移，时间复杂度为$O(1)$
  * 容器中间删除元素，涉及元素搬移，时间复杂度为$O(n)$

* 查：
   * 可通过角标和迭代器访问元素；
   * 支持随机访问；
   * 逐个元素比较查找，时间复杂度为$O(n)$

* 改：
   * 角标方式修改
   * 迭代器方式修改

**应用场景：**

* 元素个数不确定，首尾增删元素，适合构造队列；
* 容器中间增删次数较少。
